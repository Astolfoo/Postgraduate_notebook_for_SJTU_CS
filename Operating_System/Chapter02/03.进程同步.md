在OS中引入进程后，虽然提高了资源利用率和系统吞吐量，但由于进程的异步性，也会给系统造成混乱，尤其是在它们争用临界资源时。
例子：

      当多个进程去争用一台打印机时，有可能使多个进程的输出结果交织在一起，难于区分；
      当多个进程去争用共享变量、表格、链表等时，有可能只是数据处理出错。

**进程同步的主要任务**：

对多个相关进程在执行次序上进行协调，以便于并发执行的进程之间能够有效地共享资源和相互合作从而使得程序的执行具有不可再现性。

## 一、进程同步的基本概念
#### 1.两种形式的制约关系
在多道程序环境下，当程序并发执行时，由于资源共享和进程合作，使同处于一个系统中的诸进程之间可能存在着以下两种形式的制约关系。
  - （1）间接相互制约关系

      同处于一个系统中的进程，通常都共享着某种系统资源，如共享CPU、共享I/O设备等。所谓间接相互制约即源于这种资源共享。

      例如，有2个进程A和B，如果在A进程提出打印请求时，系统已将惟一的一台打印机分配给了进程B，则此时进程A只能阻塞；一旦进程B将打印机释放，则A进程才能由阻塞改为就绪状态。

  - （2）直接相互制约关系

      此类型的制约主要源于进程间的合作

    例如，有一输入进程A通过单缓冲向计算进程B提供数据。
    
        当单缓冲空时，计算进程B因不能获得所需数据而阻塞。
        当输入进程A把数据送入缓冲后，便将计算进程B唤醒；
        当单缓冲满时，输入进程A因无法再向缓冲中投放数据而阻塞，只有当计算进程B将缓冲内数据取走后便可唤醒A。
#### 2.临界资源
生产者-消费者(producer-consumer)问题是一个著名的进程同步问题。【关于生产者-消费者(producer-consumer)问题的部分会另起文章细致分析】

#### 3.临界区
把每个进程中访问资源的那段代码为临界区（critical Section）。

把一个访问临界资源的循环进程描述如下：

![](https://github.com/Soler0502H/Postgraduate_notebook_for_SJTU_Software_Program/blob/master/Images/26.png)

临界区分为了四个区。

#### 4.同步机制应遵循的规则

                 （1）空闲让进。
                  (2) 忙则等待。 
                  (3) 有限等待。 
                  (4) 让权等待。  


## 二、信号量机制
信号量机制是一种进程同步的工具

提出者：荷兰学者Dijkstra

时间：1965年

#### 1.整型信号量

最初由Dijkstra把整型信号量定义为一个整型量，除初始化外，仅能通过两个标准的原子操作(Atomic Operation) wait(S)和signal(S)来访问。这两个操作一直被分别称为P、V操作。 wait和signal操作可描述为：
```C
       wait(S): while S≤0 do no-op;
                      S∶=S-1;
        signal(S):         
                      S∶=S+1; 
```
由于wait(S)和signal(S)是两个原子操作，所以两者在执行时不可中断的。

#### 2.记录型信号量
优点：遵循“让权等待”准则。
缺点：多个进程等待访问同一临界资源。

```
Type semaphore=record value:integer;L:list of process; end
Procedure wait(S)   //请求一个单位的资源
var S:semaphore;
begin
  S.value:=S.value-1;
  if S.value<0 then block(S,L)  资源分配完毕，自我阻塞，放弃处理机
end
Procedure signal(S)  //进程释放一个单位资源
var S:semaphore;
begin
  S.value:=S.value+1;  资源数目加1
  if S.value<=0 then wakeup(S,L);说明原来至多-1，也就是至少有一个等待进程
end
```

#### AND型信号量
上述进程互斥问题，是针对进程之间要共享一个临界资源而言的。在有些应用场合，一个进程需要先获得两个或更多的共享资源后，方能执行其任务。假定现有两个进程A和B，它们都要求访问共享数据D和E。当然，共享数据都应作为临界资源。为此，可为这两个数据分别设置用于互斥的信号量Dmutex和Emutex，并令它们的初值为1，相应在两进程中都要包含两个对Dmutex和Emutex的操作，即

![](https://github.com/Soler0502H/Postgraduate_notebook_for_SJTU_Software_Program/blob/master/Images/28.PNG)

若进程A和B按下述次序交替地执行wait操作：
```
Process A:wait(Dmutex);//Dmutex=0
Process B:wait(Emutex)://Emutex=0
Process A:wait(Emutex)://Emutex=-1 A阻塞
Process B:wait(Dmutex)://Dmutex=-1 B阻塞
```

#### AND同步机制的基本思想

      将进程在整个运行过程中所需要的所有临界资源，一次性地全部分配给进程，待该进程使用完后再一起释放。
      只要尚有一个资源未能分配给该进程，其他所有可能为之分配的资源，也不分配给它。
      要么全分配，要么一个也不分配。





## 三、信号量的应用

## 四、管程机制

