## 一、操作系统的定义、目标、作用和发展的主要动力
计算机系统由**硬件和软件**两部分组成。**操作系统（OS，Operating System）** 是配置在计算机硬件上的第一层软件，是对硬件系统的首次补充。

**硬件**：计算机物理设备，即各种处理机存储器、输入/输出设备、通信设备等。

**软件**：指由计算机硬件执行以完成一定任务的所有程序以及数据。

### （一）操作系统的定义

**操作系统（OS，Operating System）**是一个管理计算机系统资源、控制程序运行的系统软件，它为用户提供了一个方便、安全、可靠的工作环境和界面。

作为计算机系统的控制和指挥中心，操作系统就是一个软件，而且是一个系统软件（System Software）。它的运行既可依赖于计算机系统的硬件（Hardware），又要管理计算机系统的一切硬件设施。

### （二）操作系统的目标

目前存在多种类型的OS，不同类型的OS，其目标各有所侧重。一般来说，就有其中以下几点：

**1.有效性**

有效性是推动操作系统发展最主要的动力。

操作系统使计算机的内存、CPU、I/O设备等资源得到充分的利用。并且还能够合理地组织计算机的工作流程，从而进一步改善系统的资源利用率和提高系统的吞吐量。

操作系统的有效性包括以下两个含意：

    1）提高系统资源利用率
  
    2）提高系统的吞吐量

**2.方便性**

操作系统的设计应尽量使得计算机系统更容易得到使用。

方便些和有效性是设计操作系统时最重要的两个目标。

**3.可扩充性**

操作系统采用了模块化结构，以便于增加新的功能模块和修改以前的功能模块。

OS具有很好的可扩充性，能够适应计算机硬件、体系结构以及应用发展的要求。

**4.开放性**

由于生产厂家生产了各种不同类型的计算机和设备，就出现了兼容性的问题，为使来自不同厂家的计算机和设备能够通过网络加以集成化，并且能够正确、有效地协同工作，实现应用的可移植性和互操作性。要求操作系统（OS）必须建立一个统一开放的开放环境就是OS要具有开放性的前提。

### （三）操作系统的作用
从不同的角度来观察操作系统的作用，从一般用户的角度来看，可把OS看作是用户与计算机硬件系统之间的接口，从资源管理的角度来看，可把OS看作是计算机系统资源的管理者。

OS实现了对计算机资源的抽象，隐藏了对硬件操作的细节。

**1.操作系统作为用户与计算机硬件系统之间的接口**

操作系统作为用户与计算机硬件西永之间的接口的含义是：OS处于用户与计算机硬件系统之间，用户通过OS来使用计算机系统。**注意**：操作系统是一个系统软件，这类型的接口属于软件接口。

OS作为接口的示意图：

![](https://github.com/Soler0502H/Postgraduate_notebook_for_SJTU_Software_Program/blob/master/Images/01.PNG)

从图中可以看出，用户可以通过三种方式使用计算机：

      1.命令方式
      2.系统调用方式
      3.图形、窗口方式
      
**2.OS作为计算机系统资源的管理者**

在计算机系统中，通常都包含了硬件和软件资源，归纳起来可将资源分为四类：处理器、存储器、I/O设备以及信息（数据和程序）。

相应地，OS的主要功能也正是针对这四类资源进行有效的管理，即：
    
    1）处理机管理：用于分配和控制处理机
    2）存储器管理：主要负责内存的分配和回收
    3）I/O设备管理：负责I/O设备的分配和操纵
    4）文件管理：负责文件的存取、共享和保护
    
**3.OS实现了对计算机资源的抽象**

在裸机（完全无软件的计算机系统）上安装OS后，便可变成一台功能显著增强，使用极为方便的多层扩充机器或多层虚拟机。

OS是铺设在计算机硬件上的多层系统软件，不仅增强了系统的功能，也隐藏了对硬件操作的细节，而且也实现了对计算机硬件操作的多个层次的抽象。

### （四）推动操作系统发展的主要动力
推动操作系统发展的主要动力，可以归结为如下四个方面：

**1.不断提高计算机资源的利用率**

在计算机发展初期，系统特别昂贵，提高计算机系统中各种资源的利用率，这是OS最初发展的推动力。由此形成了自动地对一批作业进行处理的多道批处理系统。

在20世纪60年代和70年代，出现了能有效提高I/O设备和CPU利用率的SPOOLing系统和改善存储器系统利用率的虚拟存储器技术，以及在网络环境下，在服务器上配置了允许所有的网络用户访问的文件系统和数据库系统。

**2.方便用户**

当资源利用率不高的问题得到解决，用户在上机、调试程序时的不方便性就成了主要矛盾。随后就形成了允许用户进行人机交互的分时系统，或称为多用户系统。

在10年代初出现了受到用户欢迎的图形化用户界面。

**3.器件的不断更新换代**

微电子技术的发展，也推动了计算机器件，特别是微机芯片的更新，使得计算机性能得到了提高。

在多处理机发张的同时，外部设备也得到了发展。

**4.计算机体系结构的不断发展。**

计算机体系结构的发展，也推动了OS的发展并产生新的操作系统类型。


## 二、操作系统的发展和分类
对操作系统可以采用多种方法进行分类。最常用的方法是按照其**功能**将操作系统分为三种基本类型，分别是**批处理操作系统、分时操作系统和实时操作系统**。
### （一）无操作系统的计算机系统
**1.人工操作方式**

1945年，第一台计算机诞生。

1945年到20世纪50年代中期，属于第一代计算机。

此时计算机使用真空管做成的。由于没有出现OS，运行速度慢，体积庞大、功耗非常大。

人工操作方式有以下两方面的缺点：
    
        1.用户独占全机。计算机及其全部资源只能由上机用户独占。
        2.CPU等待人工操作。当用户进行转带（卡）、卸带（卡）等人工操作时，CPU和内存等资源是空闲的。

人工操作方式严重降低了计算机资源的利用率，此时出现了人机矛盾。

**2.脱机输入I/输出方式**

为了解决人机矛盾及CPU和I/O设备之间速度不匹配的矛盾，20世纪50年代末出现了脱机输入/输出（Off-Line I/O）技术。

**技术原理**：

事先将装有用户程序和数据的纸带（或卡片）装入纸带输入机（或卡片机），在一台外围机的控制下，把纸带（卡片）上的数据（程序）输入到磁带上。当CPU需要这些程序和数据时，再从磁带上将其高速调入内存。

当CPU需要输出时，可由CPU直接高速地把数据从内存送到磁带上，然后再在另一台外围机地控制下，将磁带上地结果通过相应的输出设备输出。

**脱机输入/输出方式定义**：

程序和数据地输入和输出都是在外围机地控制下完成的，或者是它们在脱离主机的情况下进行的，所以称为脱机输入/输出方式。

**联机输入/输出方式的定义**：

在主机控制下进行输入/输出的方式称为联机输入/输出方式。

**脱机输入I/输出O方式的优点**：

        1.减少了CPU的空闲时间。
        2.提高了I/O速度。

### （二）单道批处理系统
**1.单道批处理系统的处理过程**

单道处理系统是指计算机对作业的处理都是成批进行的，但在内存中始终保持一道作业。这种系统就是在解决人际矛盾和CPU与I/O设备速率不匹配的矛盾过程中形成的。

**2.单道批处理系统的特征**

        1.自动性
        2.顺序性
        3.单道性
        
### （三）多道批处理系统
在单道批处理系统中，内容中仅有一道作业，无法成分利用系统中的所有资源，使得性能比较差。为了进一步提高资源的利用率和系统吞吐量，就引入了程序设计技术，由此产生了多道批处理系统。

**多道批处理系统的概念**

多道批处理系统允许多个程序同时装入到主存储器中，使一个中央处理器轮流地执行多个作业，各个作业同时使用各自地外围设备，提高了计算机系统的资源利用率。


**1.多道程序设计**

该技术指计算机内存中同时存放几道相互独立的程序，它们在管理程序的控制下相互交替允许。

在OS中引入了多道程序设计技术带来的好处：

        1.提高CPU的利用率。
        2.可提高内存和I/O设备利用率。
        3.增加系统吞吐量。

**2.多道批处理系统的优缺点**

1）主要优点：
        
        1.1 资源利用率高
        1.2 系统吞吐量大
        
2）主要缺点：
    
        2.1 平均周转时间长
        2.2 无交互能力
        
**3. 多道批处理系统需要解决的问题**

多道批处理系统是一种有效且十分复杂的系统，为使得计算机系统中的多道程序之间能够协调地运行，必须解决如下一些问题：

        3.1 处理机管理问题
        3.2 内存管理问题
        3.3 I/O设备管理问题
        3.4 文件管理问题
        3.5 作业管理问题
        
**4.多道批处理系统的特点**

        4.1.多道性
        4.2.无序性
        4.3.调度性

### （四）分时系统
**1.分时系统的概念以及产生**

**分时技术**：把处理机的运行时间分成很短的时间片，时间片轮流地把处理机分给各联机作业使用。

若某个作业在分配给它的时间片内不能完成计算，则该作业暂时中断，把处理机让给另一个作业使用，等待下一个时间片到时间再继续运行。

由于分时技术地出现，就早就了分时系统地出现。

分时系统是指在一台主机上连接了多个带有显示器和键盘的终端，同时允许多个用户通过自己的终端，以交互方式使用计算机，共享主机中的资源。

第一台分时操作系统CTSS（Compatable Time Sharing System）由麻省理工大学开发成功。

它经常被用于查询系统中，满足许多用户查询的需要，用户的需求具体表现在几个方面：

        1.人机交互
        2.共享主机
        3.便于用户上机

**2.分时系统的基本特点**
    
        1.多路性（同时性）：允许一台主机上同时联接多台联机终端，系统按分时原则为每个用户服务。
            宏观上：若干个用户同时使用计算机，共享系统资源
            微观上：计算机轮流上为多个作业运行时间片
            
        2.交互性：用户通过终端向主机发出请求，根据主机的响应结果，再向系统发出请求，直到得到满意结果位置。
        3.及时性：机器对用户的请求要在短时间内得到响应。
        4.独立性：每个用户使用各自的终端与主机交互，感觉不到其他用户的存在，好像是独立使用计算机系统。

### 实时系统
实时系统（Real Time System）是指系统能够及时（或即时）响应外部事件的请求，再规定时间内完成对该事件的处理，并控制所有的实时任务协调一致的运行。

在设计实时操作系统时，首先要考虑系统的实时性和可靠性。

**1.实时任务**

在实时系统中必然存在着若干个实时任务，这些任务通常与某个外部设备有关。能够及时反应或控制相应的外部设备，因而带有某种程度的紧迫性。所以可以从不同的角度对实时任务进行分类：

1）按任务执行时是否呈现周期性来划分

        1.周期性实时任务
        2.非周期性实时任务

2）根据对截止时间的要求来划分

        1.硬实时任务（Hard Real-time Task）即实时控制系统：
        系统必须满足任务对截止时间的要求，否则可能出现难以预测的结果。
        主要用于军事和工业控制领域，计算机及时测量出被控系统的各种数据，并即使作出相应处理。
        
        硬实时任务的特点：响应速度块，可靠性高。
        
        2.软实时任务（Soft Real-time Task）即实时事务处理系统：
        也是联系截止时间，但并不严格，若偶尔错过了任务的截止时间，对系统产生的影响也不会大。
        主要用户诸如订票系统、银行管理系统等方面，这些应用中，计算机对用户的请求及时作出回答，并能及时修改，处理系统中数据。
        
**2.实时系统的基本特点**

        1.及时性
        2.多路性
        3.交互性
        4.可靠性
        5.独立性
        
### （五）微机操作系统
配置在微型机的操作系统称为微机操作系统，最早诞生的微机操作系统是配置在8位微机上的CP/M。后续就出现了16位、32、64位等。

微机操作系统可按微机的字长来分，也可以按照运行方式来分如下：

**1.单用户单任务操作系统**

单用户单任务操作系统的定义是：只允许一个用户上机，且只允许用户程序作为一个任务。这种是最简单的微机操作系统，主要配置在8位和16位微机上。

最具有代表性的单用户单任务微机操作系统的是`CP/M`和`MS-DOS`。

**2.单用户多任务操作系统**

单用户多任务操作系统的含义是：只允许一个用户上机，但允许用户把程序分为若干个任务，使它们并发执行，从而有效地改善了系统地性能。

代表性的操作系统：微软早期开发的的Windows系列

**多用户多任务操作系统**

多用户多任务操作系统的含义是：允许多个用户通过各自的终端使用同一台机器，共享主机系统中的各种资源，而每个用户又可进一步分为几个任务，使它们能够并发执行，可进一步提高资源利用率和系统吞吐量。

代表性的操作系统是：UNIX OS

### 三、操作系统的基本特征
不同的操作系统具有各自的特征，但是都是具有以下四个基本的特征：

**1.并发性**

并行与并发

并行性和并发性既相似又有区别的两个概念。

并行性是指两个或多个事件在同一时刻发生。

并发性是指两个或多个事件在同一时间间隔内发生。

在多道程序环境中，并发性是指在一段时间内宏观上有多个程序同时运行，在单道处理机系统中，每一刻却能有一道程序执行，故微观上这些程序是在交替执行的。

程序的并发执行能够改善系统资源的利用率，但会使得系统复杂化。所以操作系统必须具有控制和管理各种并发事件的功能。


**2.共享性**

在操作系统环境下，共享是指系统中的资源可供内存中多个并行执行的进程（线程）共同使用，把这种资源称为资源共享或者是资源复用。

并发和共享是操作系统两个基本的特点，两者之间互为存在条件。

实现资源共享的主要方式有：
        
        1.互斥共享方式
        2.同时访问方式

**3.虚拟技术**

在操作系统中，虚拟是指把一个物理上的实体变为若干个逻辑上的对应物，前者是实际存在，后者是虚拟的，只是用户的一种感觉。

用于实现虚拟的技术叫做虚拟技术，在操作系统中，实现虚拟技术的方式有以下两种：

        1.时分复用技术
            1.1 虚拟处理机技术
            1.2 虚拟设备技术
        
        2.空分复用技术
            2.1 虚拟磁盘技术
            2.2 虚拟存储器技术
            

**4.异步性**

进程的异步性

程序的不可再现性

程序执行时间的不可预知性

### 四、操作系统的主要功能
操作系统的主要任务：为多道程序的运行提供了良好的运行环境，以保证多道程序能有条不紊地、高效地运行，最大程度地提高系统中各种资源的利用率和方便用户使用。
为实现上述任务，操作系统应具有以下几方面的功能：

**1.处理机管理功能【核心】**

在传统的多道程序系统中，处理机的分配和运行都是围绕以进程为基本单位进行。

处理机的管理的主要功能是：创建和撤销进程（线程），对诸进程（线程）的运行进行协调，实现进程（线程）之间的信息交换，以及按照一定的算法把处理机分配给进程（线程）。

处理机管理也应具有以下的功能：

1.1 进程控制

1.2 进程同步

        1.2.1 进程互斥方式
        是指诸进程（线程）在对临界资源进行访问时，应采用互斥方式。
        
        1.2.2 进程同步方式
        是指在相互合作去完成共同任务的诸进程（线程）间，由同步机构对它们的执行次序加以协调。

1.3 进程通信

在多道程序环境下，为了加速应用程序的运行，应在系统中建立多个进程，并且再为一个进程建立若干个线程，又这些线程相互合作去完成了共同的任务。然而在进程之间，又往往需要交换信息。

当相互合作的进程（线程）处于同一计算机系统时，通常在他们之间时采用直接通信方式，即由资源进程利用了发送命令直接将信息（Massage）挂到目标进程的消息队列上，以后由目标进程利用接受命令从其消息队列中取出消息。

1.4 调度

在后备队列上等待的每个作业都需要经过调度才可以执行。

        1.4.1 作业调度
        基本任务：
        从后备队列中按照一定的算法，选择出若干个作业，为它们分配运行所需的资源（首先时内存分配）。之后再将它们调入内存后，便分别为它们建立进程，使得它们都成为可能获得处理机的就绪进程，按照一定的算法将它们插入就绪队列。
        
        1.4.2 进程调度
        基本任务：
        从进程的就绪队列中，按照一定的算法选出一个进程，把处理机分配给它，并为其设置现场，使进程执行。
        
在多线程OS中，通常把线程作为独立运行和分配处理机的基本单位。

**2.存储器管理功能**

存储器管理的主要任务：为多道程序的运行提供了良好的环境，方便用户使用存储器，提高存储器的利用率以及能从逻辑上扩充内存。

存储器管理也应具有以下的功能：

2.1 内存分配

内存分配的主要任务时为每道程序分配内存空间，使得各司其职，提高存储器的利用率。

OS在实现内存分配中，可采用静态和动态两种方式。

2.2 内存保护

主要任务：
    
      2.2.1 确保每道用户程序都只在自己的内存空间内运行，彼此互不干扰。
      2.2.2 绝不允许用户程序访问操作系统的程序和数据.
      2.2.3 不允许用户程序转移到非共享的其他用户程序中执行。
      
2.3 地址映射

2.4 内存扩充


**3.设备管理功能**

设备管理用于管理计算机系统中的所有外围设备。

设备管理的主要任务：a.完成用户进程提出的I/O请求；b.为用户进程分配其所需的I/O设备；c.提高CPU和I/O设备的利用率；d.提高了I/O速度；e.方便用户使用I/O设备。

设备管理也应具有以下的功能：

3.1 缓冲管理

3.2 设备分配

3.3 设备处理


**4.文件管理功能**

现代计算机管理中，总是把程序和数据以文件的形式存储在磁盘或磁带中，方便用户使用。

文件管理的主要任务：对用户文件和系统文件进行管理，以方便用户使用，并保证文件的安全性。

文件管理的也应具有以下的功能：

4.1 文件存储空间的管理

4.2 目录管理

4.3 文件的读/写管理和保护



**5.操作系统与用户之间的接口**

方便用户使用操作系统，OS向用户提供了接口，接口可分为以下两类：

5.1 用户接口

        5.1.1 联机用户接口
        5.1.2 脱机用户接口
        5.1.3 图形用户接口

5.2 程序接口

程序接口时用户程序在执行中访问系统资源而设置的，是用户程序取得操作系统服务的唯一途径。


## 三、操作系统的运行环境【具体细节打算重新开一个文章，这里只介绍部分内容】
操作系统的主要运行环境包括系统的硬件环境和由其他的系统软件组成的软件环境，以及操作系统和使用他的人之间的关系。
#### 一）中央处理器（CPU）
**1.单处理器与多处理器系统**

单处理器系统：计算机有一个CPU

多处理器系统：计算机有多个CPU。

处理器由运算器、控制器和以及高速缓存构成。

**2.处理器中的寄存器**

两类寄存器：

   用户可见寄存器（工作寄存器）：由处理器执行的机器语言来引用，通常是对所有的程序都是可用的，包括系统程序和用户程序。
        
        机器语言直接引用
        
        包括了数据寄存器、地址寄存器以及条件码寄存器
        
        数据寄存器(Data Register):又称为通用寄存器，主要用于各种算术逻辑指令和访存指令。
        
        地址寄存器（Address Register）:用于存储数据及指令的物理地址、线性地址或者是有效地址，用于某种特定方式的地址，如索引寄存器（Index Register）、段寄存器（Segment Pointer）、栈指针（Stack Pointer）。
        
        条件码寄存器：保存CPU操作结果的各种标记位，如算术运算过程中产生的溢出、符号等。
        
   控制和状态寄存器：用户控制处理器的操作，大部分对用户是不可见的，由OS的特权代码使用。
        
        用于控制处理器的操作
        
        对于部分用户是不可见的。
        
        一部分可以在某种特权模式（由OS使用）下访问的控制和状态寄存器：
        
        程序计数器（PC，Program Counter）：记录将要取出的指令的地址。
        
        指令寄存器（IR，Instruction Register）：包含最近取出的指令。
        
        程序状态字（PSW，Program Status Word）：记录处理器的运行模式信息等。
        
**3.处理器的状态**        

根据运行程序对资源和机器指令的使用权限将处理器设置为不同的状态：

3.1 多数系统将处理器工作状态划分为**管态**和**目态**。

        管态：操作系统管理程序运行的状态，又称为特权态、系统态、管理态或核心态。
        
        目态：用户程序运行时的状态，又称为普通态或者用户态。
        
3.2 有些系统将处理器状态划分为核心状态、管理状态和用户程序状态（目标状态）三种情况。


## 四、操作系统体系结构设计
设计一个操作系统主要包括：

    功能设计
    算法设计
    结构设计
    
#### 一）传统的操作系统结构
**1.无结构的操作系统**

**2.模块化结构OS**

2.1 模块化程序设计技术的基本概念

        出现于10世纪60年代。
        
        基于”分解“和”模块化“原则控制大型软件的复杂度。

**模块接口法【模块——接口法又称为无须模块法】**

首先确定操作系统的总体功能，然后将总功能分解为若干个子功能，实现每个子功能的模块称为模块。继续分解，直至每个模块仅包含单一功能为止。最后通过接口将所有的模块连接在一起形成一个整体。

2.2 模块的独立性

在划分模块时，必须充分注意模块的独立性问题。因为模块的独立性越高，各模块之间的交互就越少，系统的结构也就越清晰。

衡量模块的独立性有以下两个标准：

        1）内聚性：指模块内部各部分间联系的紧密程度。内聚性越高，模块的独立性越强。
        
        2）耦合性：指模块见相互联系和相互影响的程度。显然，耦合度越低，模块的独立性越好。
       
2.3 模块接口法的优缺点：
    
优点：

       （1）提高OS设计的准确性、可理解性和可维护性。
       （2）增强OS的适应性
       （3）加速OS的开发过程
        
缺点：

        （1）在设计OS时，对各模块间接口规定很难满足在模块完成后对接口的实际需求。
        （2）在设计OS阶段，设计者必须作出一系列的决定（决策），每一个决定必须建立在上一个决定的基础上。


**3.分层式OS**

分层结构的优缺点：

优点：

        （1）易保证系统的正确性
        （2）易扩充和易维护性

主要缺点：系统效率降低了。由于层次结构是分层单向依赖的。必须在邻层之间建立层次间的通信机制。

#### 二）客户/服务器模式
客户/服务器（Client/Server）模式可简称为C/S模式。

2.1 客户/服务器模式的组成

客户/服务器系统主要有客户机、服务器和网络系统三部分组成。

2.2 客户/服务器之间的交互

在采用客户/服务器的系统中，通常是客户机和服务器共同完成对应用（程序）的处理。

在客户机和服务器之间就需要交互，即必须利用消息机制在两者之间进行多次通信，一次完整的交互过程可分为以下四步：

        (1)客户发送请求信息
        (2)服务器接收消息
        (3)服务器回送消息
        (4)客户机接收消息

2.3 客户/服务器模式的优点

        （1）数据的分布处理和存储
        （2）便于集中管理
        （3）灵活性和可扩充性
        （4）易于改编应用软件
  
基本客户/服务器模式的不足之处是存在着不可靠性和瓶颈问题。

#### 三）微内核OS结构
微内核（Micro Kernel）操作系统结构，20世纪80年代后期发展起来。

它支持多处理机运行，适用于分布式系统环境。例如：Carngie Mellon大学研制的Mach OS以及广泛使用的Windows 2000/XP操作系统。

**1.基本概念**：

由于微内核操作系统结构，现在尚无一致公认的定义，但是可以从以下的四个方面进行对微内核描述：

        （1）足够小的内核
        （2）基于客户/服务器模式
        （3）应用"机制与策略分离"原理
        （4）采用面向对象技术
        
**2.微内核技术**：把操作系统中更多的成分和功能放到更高的层次（即用户模式）中去运行，而留下一个尽量小的内核，用它来完成操作系统最基本的核心功能，称这种技术为微内核技术。

**3.微内核的基本功能**

        （1）进程（线程）管理
        （2）低级存储器管理
        （3）中断和陷入处理

**4.微内核操作系统的优点**

        （1）提高了系统的可扩展性
        （2）增强了系统的可靠性
        （3）可移植性
        （4）提供了对分布式系统的支持
        （5）融入了面向对象技术
        



